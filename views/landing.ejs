<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Ella Rises - Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
  <div class="container py-4">

    <!-- HEADER -->
    <header class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="h3 mb-0" style="font-family:'DM Serif Display',serif;">Ella Rises</h1>
        <small class="text-muted">Dashboard</small>
      </div>

      <div class="text-end">
        <% if (!loggedInLevel) { %>
          <!-- Public visitor -->
          <a class="btn btn-outline-secondary btn-sm" href="/login">
            User / Manager Login
          </a>

        <% } else { %>
          <!-- Logged-in user or manager -->
          <div class="mb-1">
            Logged in as <strong><%= loggedInLevel === 'M' ? 'Manager' : 'User' %></strong>
          </div>
          <a class="btn btn-outline-secondary btn-sm" href="/logout">
            Logout
          </a>
        <% } %>
      </div>
    </header>

    <!-- Embedded Tableau dashboard -->
    <div class="mb-4">
      <div class="tableauPlaceholder" id="viz1764822878988" style="position: relative">
        <noscript>
          <a href="#">
            <img alt="Ella Rises Impact Dashboard"
                 src="https://public.tableau.com/static/images/IN/INTEXTableauDashboard/EllaRisesImpactDashboard/1_rss.png"
                 style="border: none" />
          </a>
        </noscript>
        <object class="tableauViz" style="display:none;">
          <param name="host_url" value="https%3A%2F%2Fpublic.tableau.com%2F" />
          <param name="embed_code_version" value="3" />
          <param name="site_root" value="" />
          <param name="name" value="INTEXTableauDashboard/EllaRisesImpactDashboard" />
          <param name="tabs" value="no" />
          <param name="toolbar" value="yes" />
          <param name="static_image" value="https://public.tableau.com/static/images/IN/INTEXTableauDashboard/EllaRisesImpactDashboard/1.png" />
          <param name="animate_transition" value="yes" />
          <param name="display_static_image" value="yes" />
          <param name="display_spinner" value="yes" />
          <param name="display_overlay" value="yes" />
          <param name="display_count" value="yes" />
          <param name="language" value="en-US" />
        </object>
      </div>
      <script type="text/javascript">
        var divElement = document.getElementById('viz1764822878988');
        var vizElement = divElement.getElementsByTagName('object')[0];
        if (divElement.offsetWidth > 800) {
          vizElement.style.width = '100%';
          vizElement.style.height = (divElement.offsetWidth * 0.75) + 'px';
        } else if (divElement.offsetWidth > 500) {
          vizElement.style.width = '100%';
          vizElement.style.height = (divElement.offsetWidth * 0.75) + 'px';
        } else {
          vizElement.style.width = '100%';
          vizElement.style.height = '1827px';
        }
        var scriptElement = document.createElement('script');
        scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
        vizElement.parentNode.insertBefore(scriptElement, vizElement);
      </script>
    </div>

    <!-- MANAGE DATA LINKS -->
    <h2 class="h5 mb-3">Manage data</h2>

    <% if (loggedInLevel === 'M') { %>
      <!-- MANAGER VIEW -->
      <div class="list-group mb-4">
        <a class="list-group-item list-group-item-action"
           href="/users?userId=<%= loggedInUserId %>&level=<%= loggedInLevel %>">Users</a>

        <a class="list-group-item list-group-item-action"
           href="/participants?userId=<%= loggedInUserId %>&level=<%= loggedInLevel %>">Participants</a>

        <a class="list-group-item list-group-item-action"
           href="/events?userId=<%= loggedInUserId %>&level=<%= loggedInLevel %>">Events</a>

        <a class="list-group-item list-group-item-action"
           href="/surveys?userId=<%= loggedInUserId %>&level=<%= loggedInLevel %>">Surveys</a>

        <a class="list-group-item list-group-item-action"
           href="/milestones?userId=<%= loggedInUserId %>&level=<%= loggedInLevel %>">Milestones</a>

        <a class="list-group-item list-group-item-action"
           href="/donations?userId=<%= loggedInUserId %>&level=<%= loggedInLevel %>">Donations</a>
      </div>

    <% } else if (loggedInLevel === 'U') { %>
      <!-- USER VIEW (read-only) -->
      <div class="list-group mb-4">
        <a class="list-group-item list-group-item-action" href="/participants">Participants</a>
        <a class="list-group-item list-group-item-action" href="/events">Events</a>
        <a class="list-group-item list-group-item-action" href="/surveys">Surveys</a>
        <a class="list-group-item list-group-item-action" href="/milestones">Milestones</a>
        <a class="list-group-item list-group-item-action" href="/donations">Donations</a>
      </div>

    <% } else { %>
      <!-- PUBLIC VISITOR VIEW -->
      <p class="text-muted">
        Log in to access participant, event, survey, milestone, and donation tools.
      </p>
    <% } %>

    <!-- PUBLIC DONATION BUTTON -->
    <div class="mb-3">
      <a class="btn btn-primary" href="/donate">Public donation page</a>
    </div>

  </div>
</body>
</html>
